---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(FactoMineR)
library(missMDA)
library(psych)
```

```{r}
plants_all <- read_rds(here::here("try_diaz_traits_sp_mean.Rds"))

names(plants_all) <- c("species", "LA", "LMA", "N", "phot_path", "H", "SM", "SSD")

#replaces NaN with NAs for consistency later
is.nan.data.frame <- function(x)
  do.call(cbind, lapply(x, is.nan))

plants_all[is.nan(plants_all)] <- NA

# removes NA values
plants <- select(plants_all, -"phot_path") %>% 
  drop_na() %>% 
  filter(SSD>0) # remove platns with 0 SSD

plants_pca <- select(plants, -species) # without species col so can be used in PCA directly
```


# Missing traits
```{r}
miss_traits <- select(plants_all, -species) %>% 
  is.na() %>% 
  colSums() %>% 
  as.data.frame() %>%
  transmute(perc_na = ./nrow(plants_all) * 100) %>% 
  rownames_to_column(var = "trait") %>% 
  mutate(trait = fct_reorder(trait, perc_na))
```
```{r}
ggplot(miss_traits, aes(perc_na, trait)) +
  geom_bar(stat="identity") +
  labs(x="Percentage of missing data", y="Trait")
```
# First look at data

```{r}
pairs.panels(plants_pca,
density = FALSE, ellipses = FALSE, hist.col = "grey")
```

```{r}
pca1 <- PCA(plants_pca)
```


```{r}
plot.PCA(pca1, graph.type="ggplot")
```


# Log transform and normalize data


```{r}
plants2 <- map_df(plants_pca, ~log10(.) %>% scale())
```

```{r}
plants[which(is.infinite(log10(plants$SSD))),]
```

need to remove plants Ajuga reptans and 157 Carex riparia, as the SSD is 0 (updated above)


```{r}
plants <- plants %>% 
  filter(SSD>0)
```


```{r}
plot(res.pcs)
```


```{r}
res.pcs <- PCA(res.comp$completeObs)
```


```{r}
pca1 <- PCA(pca_p)
```

```{r}
plot.PCA(pca1, )
```



```{r}
pca1$eig
```

```{r}
ggplot(as.data.frame(pca1$eig), aes(`percentage of variance`)) +
  geom_bar()
```

```{r}
summary(pca1)
```
```{r}
str(pca1)
```

```{r}
 hist(pca1$ind$cos2)
```

```{r}
library(psych)

pairs.panels(pca_p,
density = FALSE, ellipses = FALSE, hist.col = "grey")
```
```{r}
which.max(plants$SM)
```

```{r}
plants[524,]
```

